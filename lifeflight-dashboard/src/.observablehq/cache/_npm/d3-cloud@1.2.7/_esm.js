/**
 * Bundled by jsDelivr using Rollup v2.79.2 and Terser v5.39.0.
 * Original file: /npm/d3-cloud@1.2.7/index.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import t from"../d3-dispatch@1.0.6/_esm.js";const n=t.dispatch,r=Math.PI/180,e={archimedean:d,rectangular:function(t){var n=4*t[0]/t[1],r=0,e=0;return function(t){var a=t<0?-1:1;switch(Math.sqrt(1+4*a*t)-a&3){case 0:r+=n;break;case 1:e+=4;break;case 2:r-=n;break;default:e-=4}return[r,e]}}},a=2048;var o=function(){var t=[256,256],r=i,o=u,p=l,M=f,m=f,w=c,b=h,z=d,I=[],k=1/0,T=n("word","end"),q=null,D=Math.random,S={},R=g;function W(n,r,e){t[0],t[1];for(var a,o,i,u,f,l=r.x,c=r.y,h=Math.sqrt(t[0]*t[0]+t[1]*t[1]),s=z(t),x=D()<.5?1:-1,d=-x;(a=s(d+=x))&&(o=~~a[0],i=~~a[1],!(Math.min(Math.abs(o),Math.abs(i))>=h));)if(r.x=l+o,r.y=c+i,!(r.x+r.x0<0||r.y+r.y0<0||r.x+r.x1>t[0]||r.y+r.y1>t[1]||e&&(f=e,!((u=r).x+u.x1>f[0].x&&u.x+u.x0<f[1].x&&u.y+u.y1>f[0].y&&u.y+u.y0<f[1].y))||y(r,n,t[0]))){for(var g,v=r.sprite,p=r.width>>5,M=t[0]>>5,m=r.x-(p<<4),w=127&m,b=32-w,I=r.y1-r.y0,k=(r.y+r.y0)*M+(m>>5),T=0;T<I;T++){g=0;for(var q=0;q<=p;q++)n[k+q]|=g<<b|(q<p?(g=v[T*p+q])>>>w:0);k+=M}return!0}return!1}return S.canvas=function(t){return arguments.length?(R=v(t),S):R},S.start=function(){var n=function(t){const n=t.getContext("2d",{willReadFrequently:!0});t.width=t.height=1;const r=Math.sqrt(n.getImageData(0,0,1,1).data.length>>2);return t.width=2048/r,t.height=a/r,n.fillStyle=n.strokeStyle="red",{context:n,ratio:r}}(R()),e=function(t){var n=[],r=-1;for(;++r<t;)n[r]=0;return n}((t[0]>>5)*t[1]),i=null,u=I.length,f=-1,l=[],c=I.map((function(t,n){return t.text=r.call(this,t,n),t.font=o.call(this,t,n),t.style=M.call(this,t,n),t.weight=m.call(this,t,n),t.rotate=w.call(this,t,n),t.size=~~p.call(this,t,n),t.padding=b.call(this,t,n),t})).sort((function(t,n){return n.size-t.size}));return q&&clearInterval(q),q=setInterval(h,0),h(),S;function h(){for(var r=Date.now();Date.now()-r<k&&++f<u&&q;){var a=c[f];a.x=t[0]*(D()+.5)>>1,a.y=t[1]*(D()+.5)>>1,s(n,a,c,f),a.hasText&&W(e,a,i)&&(l.push(a),T.call("word",S,a),i?x(i,a):i=[{x:a.x+a.x0,y:a.y+a.y0},{x:a.x+a.x1,y:a.y+a.y1}],a.x-=t[0]>>1,a.y-=t[1]>>1)}f>=u&&(S.stop(),T.call("end",S,l,i))}},S.stop=function(){q&&(clearInterval(q),q=null);for(const t of I)delete t.sprite;return S},S.timeInterval=function(t){return arguments.length?(k=null==t?1/0:t,S):k},S.words=function(t){return arguments.length?(I=t,S):I},S.size=function(n){return arguments.length?(t=[+n[0],+n[1]],S):t},S.font=function(t){return arguments.length?(o=v(t),S):o},S.fontStyle=function(t){return arguments.length?(M=v(t),S):M},S.fontWeight=function(t){return arguments.length?(m=v(t),S):m},S.rotate=function(t){return arguments.length?(w=v(t),S):w},S.text=function(t){return arguments.length?(r=v(t),S):r},S.spiral=function(t){return arguments.length?(z=e[t]||t,S):z},S.fontSize=function(t){return arguments.length?(p=v(t),S):p},S.padding=function(t){return arguments.length?(b=v(t),S):b},S.random=function(t){return arguments.length?(D=t,S):D},S.on=function(){var t=T.on.apply(T,arguments);return t===T?S:t},S};function i(t){return t.text}function u(){return"serif"}function f(){return"normal"}function l(t){return Math.sqrt(t.value)}function c(){return 30*(~~(6*random())-3)}function h(){return 1}function s(t,n,e,o){if(!n.sprite){var i=t.context,u=t.ratio;i.clearRect(0,0,2048/u,a/u);var f=0,l=0,c=0,h=e.length;for(--o;++o<h;){n=e[o],i.save(),i.font=n.style+" "+n.weight+" "+~~((n.size+1)/u)+"px "+n.font;const t=i.measureText(n.text),h=-Math.floor(t.width/2);let p=(t.width+1)*u,M=n.size<<1;if(n.rotate){var s=Math.sin(n.rotate*r),y=Math.cos(n.rotate*r),x=p*y,d=p*s,g=M*y,v=M*s;p=Math.max(Math.abs(x+v),Math.abs(x-v))+31>>5<<5,M=~~Math.max(Math.abs(d+g),Math.abs(d-g))}else p=p+31>>5<<5;if(M>c&&(c=M),f+p>=2048&&(f=0,l+=c,c=0),l+M>=a)break;i.translate((f+(p>>1))/u,(l+(M>>1))/u),n.rotate&&i.rotate(n.rotate*r),i.fillText(n.text,h,0),n.padding&&(i.lineWidth=2*n.padding,i.strokeText(n.text,h,0)),i.restore(),n.width=p,n.height=M,n.xoff=f,n.yoff=l,n.x1=p>>1,n.y1=M>>1,n.x0=-n.x1,n.y0=-n.y1,n.hasText=!0,f+=p}for(var p=i.getImageData(0,0,2048/u,a/u).data,M=[];--o>=0;)if((n=e[o]).hasText){for(var m=n.width,w=m>>5,b=n.y1-n.y0,z=0;z<b*w;z++)M[z]=0;if(null==(f=n.xoff))return;l=n.yoff;for(var I=0,k=-1,T=0;T<b;T++){for(z=0;z<m;z++){var q=w*T+(z>>5),D=p[2048*(l+T)+(f+z)<<2]?1<<31-z%32:0;M[q]|=D,I|=D}I?k=T:(n.y0++,b--,T--,l++)}n.y1=n.y0+k,n.sprite=M.slice(0,(n.y1-n.y0)*w)}}}function y(t,n,r){r>>=5;for(var e,a=t.sprite,o=t.width>>5,i=t.x-(o<<4),u=127&i,f=32-u,l=t.y1-t.y0,c=(t.y+t.y0)*r+(i>>5),h=0;h<l;h++){e=0;for(var s=0;s<=o;s++)if((e<<f|(s<o?(e=a[h*o+s])>>>u:0))&n[c+s])return!0;c+=r}return!1}function x(t,n){var r=t[0],e=t[1];n.x+n.x0<r.x&&(r.x=n.x+n.x0),n.y+n.y0<r.y&&(r.y=n.y+n.y0),n.x+n.x1>e.x&&(e.x=n.x+n.x1),n.y+n.y1>e.y&&(e.y=n.y+n.y1)}function d(t){var n=t[0]/t[1];return function(t){return[n*(t*=.1)*Math.cos(t),t*Math.sin(t)]}}function g(){return document.createElement("canvas")}function v(t){return"function"==typeof t?t:function(){return t}}export{o as default};
