<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="generator" content="Observable Framework v1.13.3">
<title>Demand Forecasting | Lifeflight Dashboard</title>
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link rel="preload" as="style" href="https://fonts.googleapis.com/css2?family=Source+Serif+4:ital,opsz,wght@0,8..60,200..900;1,8..60,200..900&amp;display=swap" crossorigin>
<link rel="preload" as="style" href="./_observablehq/theme-air,near-midnight.dcdbf18e.css">
<link rel="preload" as="style" href="./_observablehq/stdlib/inputs.ea9fd553.css">
<link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css2?family=Source+Serif+4:ital,opsz,wght@0,8..60,200..900;1,8..60,200..900&amp;display=swap" crossorigin>
<link rel="stylesheet" type="text/css" href="./_observablehq/theme-air,near-midnight.dcdbf18e.css">
<link rel="stylesheet" type="text/css" href="./_observablehq/stdlib/inputs.ea9fd553.css">
<link rel="modulepreload" href="./_observablehq/client.33da7c34.js">
<link rel="modulepreload" href="./_observablehq/runtime.e080113b.js">
<link rel="modulepreload" href="./_observablehq/stdlib.73a8ec5a.js">
<link rel="modulepreload" href="./_import/components/demand-forecasting/correlationPlot.765dfd2e.js">
<link rel="modulepreload" href="./_import/components/demand-forecasting/prepareLineChartData.5f070e0c.js">
<link rel="modulepreload" href="./_import/components/demand-forecasting/forecastChart.49f0c731.js">
<link rel="modulepreload" href="./_import/components/demand-forecasting/metrics.601fa448.js">
<link rel="modulepreload" href="./_import/components/demand-forecasting/demandHeatmap.c78baf50.js">
<link rel="modulepreload" href="./_npm/htl@0.3.1/72f4716c.js">
<link rel="modulepreload" href="./_observablehq/stdlib/inputs.4ef1d259.js">
<link rel="modulepreload" href="./_npm/@observablehq/plot@0.6.17/d761ef9b.js">
<link rel="modulepreload" href="./_npm/d3@7.9.0/e780feca.js">
<link rel="modulepreload" href="./_npm/isoformat@0.2.1/18cbf477.js">
<link rel="modulepreload" href="./_npm/interval-tree-1d@1.0.4/53fe8176.js">
<link rel="modulepreload" href="./_npm/d3-array@3.2.4/e93ca09f.js">
<link rel="modulepreload" href="./_npm/d3-axis@3.0.0/0f2de24d.js">
<link rel="modulepreload" href="./_npm/d3-brush@3.0.0/65eb105b.js">
<link rel="modulepreload" href="./_npm/d3-chord@3.0.1/7ef8fb2e.js">
<link rel="modulepreload" href="./_npm/d3-color@3.1.0/aeb57b94.js">
<link rel="modulepreload" href="./_npm/d3-contour@4.0.2/1d2aed74.js">
<link rel="modulepreload" href="./_npm/d3-delaunay@6.0.4/5ced1d52.js">
<link rel="modulepreload" href="./_npm/d3-dispatch@3.0.1/9ba9c7f3.js">
<link rel="modulepreload" href="./_npm/d3-drag@3.0.0/4202580c.js">
<link rel="modulepreload" href="./_npm/d3-dsv@3.0.1/9cffc2bd.js">
<link rel="modulepreload" href="./_npm/d3-ease@3.0.1/cdd7e898.js">
<link rel="modulepreload" href="./_npm/d3-fetch@3.0.1/b4e2ad9a.js">
<link rel="modulepreload" href="./_npm/d3-force@3.0.0/5e804d15.js">
<link rel="modulepreload" href="./_npm/d3-format@3.1.0/86074ef6.js">
<link rel="modulepreload" href="./_npm/d3-geo@3.1.1/40599fb3.js">
<link rel="modulepreload" href="./_npm/d3-hierarchy@3.1.2/e49e792c.js">
<link rel="modulepreload" href="./_npm/d3-interpolate@3.0.1/8d1e5425.js">
<link rel="modulepreload" href="./_npm/d3-path@3.1.0/20d3f133.js">
<link rel="modulepreload" href="./_npm/d3-polygon@3.0.1/7553081f.js">
<link rel="modulepreload" href="./_npm/d3-quadtree@3.0.1/0dfd751c.js">
<link rel="modulepreload" href="./_npm/d3-random@3.0.1/3c90ee06.js">
<link rel="modulepreload" href="./_npm/d3-scale@4.0.2/843b6a76.js">
<link rel="modulepreload" href="./_npm/d3-scale-chromatic@3.1.0/ba24c2e7.js">
<link rel="modulepreload" href="./_npm/d3-selection@3.0.0/4d94e5b7.js">
<link rel="modulepreload" href="./_npm/d3-shape@3.2.0/6d3a6726.js">
<link rel="modulepreload" href="./_npm/d3-time@3.1.0/9f03c579.js">
<link rel="modulepreload" href="./_npm/d3-time-format@4.1.0/07c9626f.js">
<link rel="modulepreload" href="./_npm/d3-timer@3.0.1/b58a267d.js">
<link rel="modulepreload" href="./_npm/d3-transition@3.0.1/004da2ac.js">
<link rel="modulepreload" href="./_npm/d3-zoom@3.0.0/b5786b3f.js">
<link rel="modulepreload" href="./_npm/binary-search-bounds@2.0.5/cbf6ba23.js">
<link rel="modulepreload" href="./_npm/internmap@2.0.3/e08981d9.js">
<link rel="modulepreload" href="./_npm/delaunator@5.0.1/02d43215.js">
<link rel="modulepreload" href="./_npm/robust-predicates@3.0.2/aa00730b.js">
<link rel="icon" href="./_file/observable.1af93621.png" type="image/png" sizes="32x32">
<script type="module">

import {define} from "./_observablehq/client.33da7c34.js";

define({id: "ff830b14", inputs: ["view","Inputs"], outputs: ["periods","seasonalityMode","growth","yearlySeasonality","changepointPriorScale","seasonalityPriorScale","intervalWidth"], body: (view,Inputs) => {
const periods = view(Inputs.range([1, 10], {
  label: "Predict years",
  value: 1,
  step: 1,
}))

const seasonalityMode = view(Inputs.select(
  ["additive", "multiplicative"],
  {
    label: "Seasonality Mode",
    value: "additive",
    format: (x) => x === "additive" ? "Additive Mode" : "Multiplicative Mode"
  }
))

const growth = view(Inputs.select(
  ["linear", "logistic"],
  {
    label: "Growth Mode",
    value: "linear",
    format: (x) => x === "linear" ? "Linear Growth" : "Logistic Growth"
  }
))

const yearlySeasonality = view(Inputs.toggle(
  {
    label: "Yearly Seasonality",
    value: true,
   }
  ))


const changepointPriorScale = view(Inputs.range([0.001, 0.5], {
  label: "Changepoint Prior Scale",
  value: 0.05,
  step: 0.001,
  format: (x) => x.toFixed(3)
}))

const seasonalityPriorScale = view(Inputs.range([0.1, 50], {
  label: "Seasonality Prior Scale",
  value: 10.0,
  step: 0.1,
  format: (x) => x.toFixed(1)
}))

const intervalWidth = view(Inputs.range([0.5, 0.99], {
  label: "Confidence Interval Width",
  value: 0.95,
  step: 0.01,
}))
return {periods,seasonalityMode,growth,yearlySeasonality,changepointPriorScale,seasonalityPriorScale,intervalWidth};
}});

define({id: "0fd43ffc", outputs: ["corrResponse","corrData"], body: async () => {
const corrResponse = await fetch('http://localhost:5001/api/get_corr_matrix')
const corrData = await corrResponse.json()
return {corrResponse,corrData};
}});

define({id: "b4224773", outputs: ["correlationPlot"], body: async () => {
const {correlationPlot} = await import("./_import/components/demand-forecasting/correlationPlot.765dfd2e.js");

return {correlationPlot};
}});

define({id: "f1358ac4", inputs: ["view","Inputs"], outputs: ["availableRegressors","extraVars","regressorMode","regressorPriorScale"], body: (view,Inputs) => {
const availableRegressors = [
  'age_under_5_ratio',
  'age_5_9_ratio',
  'age_10_19_ratio',
  'age_20_29_ratio',
  'age_30_39_ratio',
  'age_40_49_ratio',
  'age_50_59_ratio',
  'age_60_69_ratio',
  'age_70_79_ratio',
  'age_80_84_ratio',
  'age_85_plus_ratio',
  'total_population'
];

const extraVars = view(Inputs.checkbox(availableRegressors, {
  label: "Extra Regressors",
  multiple: true,
  value: []
}))

const regressorMode = view(Inputs.radio(['additive','multiplicative'],
{
  label: "Regressor Mode",
  value: "additive"
}
))

const regressorPriorScale = view(Inputs.range([0.001, 0.5], {
  label: "Regressor Prior Scale",
  value: 0.05,
  step: 0.001,
  format: (x) => x.toFixed(3)
}))
return {availableRegressors,extraVars,regressorMode,regressorPriorScale};
}});

define({id: "13a8efaf", mode: "inline", inputs: ["correlationPlot","corrData","display"], body: async (correlationPlot,corrData,display) => {
display(await(
correlationPlot(corrData.data.count_correlations)
))
}});

define({id: "c71bc86c", inputs: ["periods","growth","seasonalityMode","yearlySeasonality","changepointPriorScale","seasonalityPriorScale","intervalWidth","extraVars","regressorPriorScale","regressorMode"], outputs: ["modelParams","forecastData","error"], body: async (periods,growth,seasonalityMode,yearlySeasonality,changepointPriorScale,seasonalityPriorScale,intervalWidth,extraVars,regressorPriorScale,regressorMode) => {
const modelParams = {
  periods: periods*12,
  growth,
  seasonality_mode: seasonalityMode,
  yearly_seasonality: yearlySeasonality,
  changepoint_prior_scale: changepointPriorScale,
  seasonality_prior_scale: seasonalityPriorScale,
  interval_width: intervalWidth,
  extra_vars: extraVars || [],
  regressor_prior_scale: regressorPriorScale || null,
  regressor_mode: regressorMode || null,
};

let forecastData = null;
let error = null;

try{
  const response = await fetch('http://localhost:5001/api/predict_demand_v2', {
    method: 'POST',
    headers: {
      "Content-Type": "application/json"
    },
    body: JSON.stringify(modelParams)
  })
  if(!response.ok){
    throw new Error(`HTTP ${response.status}: ${response.statusText}`)
  }
  forecastData = await response.json()
  error = null
} catch (e) {
  error = e.message
  forecastData = null
  console.error('fetch error:', e)
}
  
return {modelParams,forecastData,error};
}});

define({id: "81b9eff4", outputs: ["prepareChartData"], body: async () => {
const {prepareChartData} = await import("./_import/components/demand-forecasting/prepareLineChartData.5f070e0c.js");

return {prepareChartData};
}});

define({id: "1304ce2a", inputs: ["forecastData","prepareChartData"], outputs: ["chartData"], body: (forecastData,prepareChartData) => {
const chartData = forecastData?.data ? prepareChartData(forecastData) : null;
return {chartData};
}});

define({id: "d2ae3614", outputs: ["forecastChart","calculateMetrics"], body: async () => {
const [{forecastChart}, {calculateMetrics}] = await Promise.all([import("./_import/components/demand-forecasting/forecastChart.49f0c731.js"), import("./_import/components/demand-forecasting/metrics.601fa448.js")]);

return {forecastChart,calculateMetrics};
}});

define({id: "1f2dde64", inputs: ["error","html"], body: (error,html) => {
if(error){
  html`<div style="color: red;">Error: ${error}</div>`
}
}});

define({id: "a969b845", inputs: ["forecastChart","chartData","display"], body: async (forecastChart,chartData,display) => {
display(await(
forecastChart(chartData)
))
}});

define({id: "58c5807b", inputs: ["calculateMetrics","forecastData","display"], body: async (calculateMetrics,forecastData,display) => {
display(await(
calculateMetrics(forecastData.data.cv_metrics)
))
}});

define({id: "74d40acb", inputs: ["view","Inputs"], outputs: ["heatmapYear","heatmapMonth"], body: (view,Inputs) => {
const heatmapYear = view(Inputs.range([2013,2023],{
  label:'Select Year',
  step:1,
  value:2013,
  }
))

const heatmapMonth = view(Inputs.radio(
    new Map([
      ["JAN", 1],
      ["FEB", 2],
      ["MAR", 3],
      ["APR", 4],
      ["MAY", 5],
      ["JUN", 6],
      ["JUL", 7],
      ["AUG", 8],
      ["SEP", 9],
      ["OCT", 10],
      ["NOV", 11],
      ["DEC", 12],
    ]),
    {value: 1, label: "Select Month", format: ([name, value]) => `${name}`}
  ))
return {heatmapYear,heatmapMonth};
}});

define({id: "d7dce441", inputs: ["URLSearchParams","heatmapYear","heatmapMonth"], outputs: ["heatmapParams","heatMapResponse"], body: async (URLSearchParams,heatmapYear,heatmapMonth) => {
// fetch 1.2
const heatmapParams = new URLSearchParams({
  year: heatmapYear.toString(),
  month: heatmapMonth.toString(),
})
const heatMapResponse = await fetch(`http://localhost:5001/api/seasonality_heatmap?${heatmapParams}`)
if (!heatMapResponse.ok) {
    const errorData = await heatMapResponse.json();
    throw new Error(errorData.message || `HTTP error! status: ${heatMapResponse.status}`);
  }
return {heatmapParams,heatMapResponse};
}});

define({id: "db6bc19c", inputs: ["heatMapResponse"], outputs: ["heatmapData"], body: async (heatMapResponse) => {
const heatmapData= await heatMapResponse.json()
return {heatmapData};
}});

define({id: "0e32ad70", outputs: ["demandHeatmap"], body: async () => {
const {demandHeatmap} = await import("./_import/components/demand-forecasting/demandHeatmap.c78baf50.js");

return {demandHeatmap};
}});

define({id: "47c41076", inputs: ["demandHeatmap","heatmapData","heatmapYear","heatmapMonth","display"], body: async (demandHeatmap,heatmapData,heatmapYear,heatmapMonth,display) => {
display(await(
demandHeatmap(heatmapData.data,heatmapYear,heatmapMonth)
))
}});

</script>
</head>
<body>
<input id="observablehq-sidebar-toggle" type="checkbox" title="Toggle sidebar">
<label id="observablehq-sidebar-backdrop" for="observablehq-sidebar-toggle"></label>
<nav id="observablehq-sidebar">
  <ol>
    <label id="observablehq-sidebar-close" for="observablehq-sidebar-toggle"></label>
    <li class="observablehq-link"><a href="./">Lifeflight Dashboard</a></li>
  </ol>
  <section class="observablehq-section-active">
    <summary>Forecasting</summary>
    <ol>
    <li class="observablehq-link observablehq-link-active"><a href="./demand-forecasting">Demand Forecasting</a></li>
    </ol>
  </section>
  <section>
    <summary>What-If Scenarios: Coverage Optimization</summary>
    <ol>
    <li class="observablehq-link"><a href="./base-analysis">Base analysis</a></li>
    <li class="observablehq-link"><a href="./scenario-modeling">All Units Coverage</a></li>
    <li class="observablehq-link"><a href="./ground-unit">Ground Units Coverage</a></li>
    </ol>
  </section>
</nav>
<script>{const e=document.querySelector("#observablehq-sidebar"),o=document.querySelector("#observablehq-sidebar-toggle"),r=sessionStorage.getItem("observablehq-sidebar");r?o.checked=r==="true":o.indeterminate=!0;for(const t of document.querySelectorAll("#observablehq-sidebar summary")){const s=t.parentElement;switch(sessionStorage.getItem(`observablehq-sidebar:${t.textContent}`)){case"true":s.open=!0;break;case"false":s.classList.contains("observablehq-section-active")||(s.open=!1);break}}addEventListener("beforeunload",()=>sessionStorage.setItem("observablehq-sidebar-scrolly",`${e.scrollTop}`));const a=sessionStorage.getItem("observablehq-sidebar-scrolly");a!=null&&(e.style.cssText="overflow: hidden;",e.scrollTop=+a,e.style.cssText="");}</script>
<div id="observablehq-center">
<aside id="observablehq-toc" data-selector="h1:not(:first-of-type)[id], h2:first-child[id], :not(h1) + h2[id]">
<nav>
<div>Contents</div>
<ol>
<li class="observablehq-secondary-link"><a href="#1-1-prophet-model-prediction">1.1 Prophet Model Prediction</a></li>
<li class="observablehq-secondary-link"><a href="#1-2-day-of-week-hour-heatmap">1.2 Day-of-Week/Hour Heatmap</a></li>
</ol>
</nav>
</aside>
<main id="observablehq-main" class="observablehq">
<div class="breadcrumb" style="margin-bottom: 2rem; color: #666; font-size: 0.9rem;">
  <a href="./">Home</a> › 
  <span style="color: #333; font-weight: 500;">Forecasting</span> › 
  <span style="color: #333; font-weight: 500;">1 Demand Forecasting</span>
</div>
<h1 id="1-demand-forecasting" tabindex="-1"><a class="observablehq-header-anchor" href="#1-demand-forecasting">1 Demand Forecasting</a></h1>
<br>
<h2 id="1-1-prophet-model-prediction" tabindex="-1"><a class="observablehq-header-anchor" href="#1-1-prophet-model-prediction">1.1 Prophet Model Prediction</a></h2>
<p>Using the Prophet model, we forecast LifeFlight’s future demand based on historical data from 2013–2023. The target is the total number of missions per month. Prophet captures long-term trends and seasonal patterns, and it also supports extra regressors to enhance forecasting performance.</p>
<p>You can adjust the model parameters below.</p>
<h3 id="input-parameters" tabindex="-1"><a class="observablehq-header-anchor" href="#input-parameters">Input parameters</a></h3>
<div class="card">
<h4>Basic parameters</h4><h4>
<div>
<div class="observablehq observablehq--block"><!--:ff830b14:--></div>
</div>
</h4></div>
<div class="observablehq observablehq--block"><!--:0fd43ffc:--></div>
<div class="observablehq observablehq--block"><!--:b4224773:--></div>
<div class="grid grid-cols-2">
<div class="card">
<h4>Extra variables parameters</h4><h4>
<div class="observablehq observablehq--block"><!--:f1358ac4:--></div>
</h4></div>
<div class="card">
<observablehq-loading></observablehq-loading><!--:13a8efaf:-->
</div>
</div>
<div class="observablehq observablehq--block"><!--:c71bc86c:--></div>
<div class="observablehq observablehq--block"><!--:81b9eff4:--></div>
<div class="observablehq observablehq--block"><!--:1304ce2a:--></div>
<div class="observablehq observablehq--block"><!--:d2ae3614:--></div>
<h3 id="predict-chart" tabindex="-1"><a class="observablehq-header-anchor" href="#predict-chart">Predict Chart</a></h3>
<div class="observablehq observablehq--block"><!--:1f2dde64:--></div>
<div class="observablehq observablehq--block"><observablehq-loading></observablehq-loading><!--:a969b845:--></div>
<h3 id="model-performance-metrics" tabindex="-1"><a class="observablehq-header-anchor" href="#model-performance-metrics">Model Performance Metrics</a></h3>
<div class="observablehq observablehq--block"><observablehq-loading></observablehq-loading><!--:58c5807b:--></div>
<h2 id="1-2-day-of-week-hour-heatmap" tabindex="-1"><a class="observablehq-header-anchor" href="#1-2-day-of-week-hour-heatmap">1.2 Day-of-Week/Hour Heatmap</a></h2>
<p>This chart aggregates historical operational data by weekday and hour to reveal cyclical patterns in LifeFlight demand. Color intensity represents the number of missions in each hour, highlighting differences between weekdays and weekends and variations across times of day.</p>
<p>Please select the year and month you’d like to view.</p>
<div class="observablehq observablehq--block"><!--:74d40acb:--></div>
<div class="observablehq observablehq--block"><!--:d7dce441:--></div>
<div class="observablehq observablehq--block"><!--:db6bc19c:--></div>
<div class="observablehq observablehq--block"><!--:0e32ad70:--></div>
<div class="observablehq observablehq--block"><observablehq-loading></observablehq-loading><!--:47c41076:--></div>
</main>
<footer id="observablehq-footer">
<nav><a rel="prev" href="./"><span>Lifeflight Dashboard</span></a><a rel="next" href="./base-analysis"><span>Base analysis</span></a></nav>
<div>Built with <a href="https://observablehq.com/" target="_blank" rel="noopener noreferrer">Observable</a> on <a title="2025-12-06T15:37:29">Dec 6, 2025</a>.</div>
</footer>
</div>
</body>
</html>
